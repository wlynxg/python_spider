# Bç«™æœç´¢ç»“æœé“¾æ¥çˆ¬å–

### ä¸€ã€ç®€ä»‹

ç½‘å€ï¼š[https://search.bilibili.com](https://search.bilibili.com)

æ•ˆæœï¼š**é“¾æ¥**

ä½¿ç”¨æ¡†æ¶ï¼š**requestsã€json**

éš¾åº¦ç³»æ•°ï¼š**âœ©âœ©**

## äºŒã€æ•™ç¨‹

ä»Šå¤©æˆ‘ä»¬å°±è¦å¯¹æˆ‘ä»¬çš„å°ç ´ç«™ä¸‹æ‰‹äº†ï¼Œå˜¿å˜¿

![](http://img.doutula.com/production/uploads/image/2018/03/03/20180303008836_cgwRhx.jpg)

#### 1. ç½‘ç«™åˆ†æ

![image-20200728224506806](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728224506806.png)

éšä¾¿æœç´¢ä¸€ä¸ªå…³é”®è¯ï¼Œå®¡æŸ¥æºä»£ç ï¼Œå¯ä»¥å‘ç°æ•°æ®åœ¨ç½‘é¡µæºç é‡Œé¢éƒ½æœ‰ã€‚

é‚£ä¹ˆå¯ä»¥é‡‡å–å’Œçˆ¬å–è±†ç“£Top250ä¸€æ ·çš„æ€è·¯ï¼šä¸‹è½½ç½‘é¡µï¼Œæå–ä¿¡æ¯ã€‚

okï¼Œä»Šå¤©çš„æ•™ç¨‹åˆ°æ­¤ç»“æŸ![å¤§å®¶æ´—æ´—ç¡å§](http://img.doutula.com/production/uploads/image/2020/07/07/20200707082943_yWYBpG.jpg)

åˆ«æ€¥åˆ«æ€¥ï¼Œä¸Šé¢é‚£ç§æ€è·¯å¤ªå¸¸è§„äº†ï¼Œä»Šå¤©æˆ‘ä»¬é‡‡å–ä¸€ç§æ›´åŠ **é«˜æ¡£ã€ä¼˜é›…**çš„æ–¹æ³•~

å›åˆ°æœç´¢é¡µé¢ï¼Œè°·æ­Œæµè§ˆå™¨ä½¿ç”¨å¿«æ·é”®**Ctrl+Shift+I**æˆ–è€…åœ¨ç½‘é¡µå†…å³é”®æ£€æŸ¥è¿›å…¥è°ƒè¯•ç•Œé¢ï¼Œæ‰¾åˆ°**Network**ï¼Œ

![image-20200728225604942](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728225604942.png)

ç„¶åå†åˆ·æ–°ç½‘é¡µï¼Œæˆ‘ä»¬ä¼šå‘ç°å¤šäº†å¾ˆå¤šä¸œè¥¿

![image-20200728225712708](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728225712708.png)

åœ¨ä¸€ä¸ªä»¥ **v2?context=&page=1...** å¼€å¤´çš„è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬åœ¨ **Preview** é‡Œå‘ç°äº†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿ï¼š

![image-20200728230212032](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728230212032.png)

è¿™äº›æ•°æ®ä¹‹æ‰€ä»¥æœ‰è¶£ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å’Œæˆ‘ä»¬é¡µé¢ä¸­çœ‹åˆ°çš„æ•°æ®æ˜¯æœ‰ç€å…³è”çš„ï¼š

![image-20200728230501389](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728230501389.png)

![](http://img.doutula.com/production/uploads/image/2018/12/10/20181210408297_fIrEah.jpg)

ç­”æ¡ˆå·²ç»æ­æ™“äº†ï¼Œé¡µé¢ä¸­å‘ˆç°ç»™æˆ‘ä»¬çš„æ•°æ®éƒ½æ˜¯é€šè¿‡æ‹¿è¿™ä¸ªè¯·æ±‚ä¸­çš„æ•°æ®å±•ç¤ºç»™æˆ‘ä»¬çš„ã€‚æ—¢ç„¶äººå®¶éƒ½æŠŠæ•°æ®æ•´æ•´é½é½çš„æ’æ•´å¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥è¯·æ±‚è¿™ä¸ªé“¾æ¥æ‹¿æ•°æ®ä¸å°±å¥½äº†å—ğŸ˜

åˆ«æ…Œï¼Œæˆ‘ä»¬è¿˜è¦å†éªŒè¯ä¸€ç•ªï¼Œçœ‹çœ‹å…¶å®ƒåˆ†é¡µå’Œå…¶å®ƒæœç´¢å…³é”®è¯æ˜¯å¦ä¹Ÿæ˜¯è¿™ç§æ¨¡å¼çš„ï¼š

![image-20200728231122646](C:\Users\I can learn!\Desktop\pyspiser-100\image-20200728231122646.png)

åœ¨ç‚¹å‡»è¿›å…¥ç¬¬äºŒé¡µæ˜¯ï¼Œæˆ‘ä»¬å‘ç°è¯·æ±‚çš„é“¾æ¥å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ä»¥ **v2?context=&page=1...** å¼€å¤´çš„é“¾æ¥äº†ï¼Œè€Œå˜æˆäº†ä»¥**type?context=&page=2&...** å¼€å¤´çš„é“¾æ¥ã€‚

ç»è¿‡å¤šæ¬¡åˆ†æå‘ç°ä¸åŒæœç´¢å…³é”®è¯çš„ç¬¬ä¸€åˆ†é¡µçš„æ•°æ®è¯·æ±‚éƒ½æ˜¯ä»¥ **v2?context=&page=1...** å¼€å¤´ï¼Œå…¶ä½™åˆ†é¡µçš„è¯·æ±‚éƒ½æ˜¯ä»¥**type?context=&page=2&... **å¼€å¤´ã€‚

#### 2. çˆ¬è™«æ€è·¯

```mermaid
graph LR
A(è¾“å…¥å…³é”®è¯) --> B(è¯·æ±‚æ•°æ®)
	B --> |v2?context=&page=1...|C(ç¬¬ä¸€åˆ†é¡µ)
    B --> |type?context=&page=2&...|D(å…¶ä½™åˆ†é¡µ)
    C --> E(å®Œæ•´æ•°æ®)
    D --> E(å®Œæ•´æ•°æ®)
```

#### 3. æ„é€ çˆ¬è™«

åœ¨å®é™…æ“ä½œçˆ¬è™«çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‘ç° **headers** ä¸­ä»…ä»…åŠ å…¥ä¸€ä¸ª **User-Agent** ï¼Œæ˜¯è·å–ä¸åˆ°æ•°æ®çš„ã€‚

ç»è¿‡å°è¯•ï¼Œå‘ç°è¿˜è¦åŠ å…¥ä¸€ä¸ª **Referer** æ‰å¯ä»¥çˆ¬å–åˆ°æ•°æ®ï¼Œè¯¥å‚æ•°çš„ä½œç”¨æ˜¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œè¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªä¸ªé“¾æ¥è¿‡æ¥çš„ã€‚

æ›´æ”¹åçš„ **headers**ï¼š

```python
headers = {
        'User-Agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) "
                      "Chrome/84.0.4147.89 Safari/537.36",
        'Referer': "https://search.bilibili.com"
    }
```

è¯·æ±‚åˆ°æ•°æ®åæˆ‘ä»¬é€šè¿‡å¯ä»¥é€šè¿‡ **json** æ¨¡å—å°†æ•°æ® **è½¬åŒ–ä¸ºPythonçš„å­—å…¸å¯¹è±¡**ï¼Œç”±äºè¯·æ±‚å¾—åˆ°çš„å†…å®¹éæ ‡å‡†jsonæ ¼å¼ï¼Œæˆ‘ä»¬éœ€è¦å»æ‰é¦–ä½å†—ä½™å­—ç¬¦ä¸²åå†è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œå¦åˆ™ç¨‹åºä¼šæŠ›å‡ºæ ¼å¼é”™è¯¯çš„å¼‚å¸¸:

```python
import json
import requests

url = "https://api.bilibili.com/x/web-interface/search/all/v2?context=&page=1&order=&keyword=%E7%BA%A6%E4%BC%9A%E5%A4%A7%E4%BD%9C%E6%88%98&duration=&tids_1=&tids_2=&__refresh__=true&_extra=&highlight=1&single_column=0&jsonp=jsonp&callback=__jp2"

headers = {
        'User-Agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) "
                      "Chrome/84.0.4147.89 Safari/537.36",
        'Referer': "https://search.bilibili.com"
    }

response = requests.get(url=url, headers=headers).text
data = json.loads(response[6:len(response) - 1])  # å»æ‰é¦–å°¾å¤šä½™å­—ç¬¦ä¸²
```

#### 4. å®Œæ•´ä»£ç 
[ä¼ é€é—¨]([[https://github.com/1314liuwei/python_spider/blob/master/No.3%20B%E7%AB%99%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E9%93%BE%E6%8E%A5%E7%88%AC%E5%8F%96/main.py](https://github.com/1314liuwei/python_spider/blob/master/No.3 Bç«™æœç´¢ç»“æœé“¾æ¥çˆ¬å–/main.py))
