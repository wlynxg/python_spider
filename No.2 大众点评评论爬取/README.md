# å¤§ä¼—ç‚¹è¯„è¯„è®ºçˆ¬å–

### ä¸€ã€ç®€ä»‹

ç½‘å€ï¼š[http://www.dianping.com/shop/G41gaJfqGBICtiVY](http://www.dianping.com/shop/G41gaJfqGBICtiVY)

æ•ˆæœï¼š**çˆ¬å–è¯„è®º**

ä½¿ç”¨æ¡†æ¶ï¼š**seleniumã€requestsã€re**

éš¾åº¦ç³»æ•°ï¼š**âœ©âœ©âœ©âœ©âœ©**

### å¼•è¨€

> å¤§ä¼—ç‚¹è¯„çš„åçˆ¬æªæ–½ä¸€ç›´éƒ½æ˜¯å“å½“å½“çš„ï¼Œæœ€è¿‘ç”±äºä½œä¸šéœ€è¦ï¼Œéœ€è¦æ¥ç¢°ä¸€ç¢°è¿™ä¸ªéœ‰å¤´ã€‚æ²¡åŠæ³•ï¼Œåªèƒ½ç¡¬ç€å¤´çš®ä¸Šäº†ã€‚
> ç»è¿‡ä¸€ä¸Šåˆçš„è‰°éš¾åˆ†æç»ˆäºå®ç°äº†æ•´ä¸ªè¿‡ç¨‹ã€‚æ•´ä¸ªåˆ†æè¿‡ç¨‹çŠ¹å¦‚ç©äº†ä¸€åœºç´§å¼ åˆºæ¿€çš„å¯†å®¤é€ƒç”Ÿã€‚
### äºŒã€æ•™ç¨‹

#### 1. ç½‘ç«™åˆ†æ

##### è¯„è®ºåˆ†æ

æœ¬æ¬¡çˆ¬è™«é€‰å–çš„æ˜¯å››å·æˆéƒ½çš„ä¸€å®¶é¤å…ï¼š[é¥•æ—é¤å…(æ˜¥ç†™è·¯åº—)](http://www.dianping.com/shop/G41gaJfqGBICtiVY)
![è¯„è®ºé¦–é¡µ](https://img-blog.csdnimg.cn/20200618223703718.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)

**æŸ¥çœ‹å®Œæ•´è¯„è®ºæ—¶å‘ç°éœ€è¦ç™»é™†**
![æŸ¥çœ‹è¯„è®ºè¯¦æƒ…](https://img-blog.csdnimg.cn/20200618223835137.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
**æŸ¥çœ‹æ›´å¤šè¯„è®ºæ—¶å‘ç°ä¹Ÿéœ€è¦ç™»é™†**
![æŸ¥çœ‹æ›´å¤šè¯„è®ºä¿¡æ¯](https://img-blog.csdnimg.cn/20200618223957707.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)**ç»“è®º:**
ç»è¿‡ç®€å•åˆ†æåå‘ç°æƒ³è¦çˆ¬å–è¯„è®ºçš„è¯æ˜¯å¿…é¡»è¦ç™»å½•çš„äº†ã€‚

**ç™»å½•åå†å¯¹é¡µé¢è¿›è¡Œåˆ†æ**
![å±•å¼€è¯„è®º](https://img-blog.csdnimg.cn/20200618224544115.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
å®¡æŸ¥é¡µé¢å…ƒç´ å‘ç°å±•å¼€å®Œæ•´è¯„è®ºæ˜¯è§¦å‘äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶
åˆ©ç”¨æµè§ˆå™¨æŠ“åŒ…å‘ç°è¯„è®ºçš„æ•°æ®æ˜¯åœ¨é¡µé¢åˆå§‹åŒ–æ—¶æ‹¿åˆ°çš„æ•°æ®ï¼Œå±•å¼€æ•°æ®å‘ç°
![æµè§ˆå™¨æŠ“åŒ…](https://img-blog.csdnimg.cn/20200618225438942.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
æŸ¥çœ‹æ•°æ®å‘ç°è¯„è®ºéƒ¨åˆ†æ–‡å­—è¢« **\<svgmtsi class="review"></svgmtsi>** æ›¿æ¢
![æŸ¥çœ‹ä¿¡æ¯è¯„è®ºå®Œæ•´ä¿¡æ¯](https://img-blog.csdnimg.cn/20200618225836226.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
ä½†æ˜¯å‘ç°æ•°æ®åŒ…çš„è¯·æ±‚é“¾æ¥æ¯”è¾ƒå¤æ‚ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯é€šè¿‡jsåŠ å¯†æ„é€ çš„
![æ•°æ®é“¾æ¥](https://img-blog.csdnimg.cn/20200618231117355.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)æŸ¥çœ‹æ›´å¤šç½‘é¡µå‘ç°é“¾æ¥å‚æ•°å¯ä»¥æ„é€ ï¼š
- **ç¬¬1é¡µ**[http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p1](http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p1)
- **ç¬¬2é¡µ**[http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p2](http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p2)
- **ç¬¬3é¡µ**[http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p3](http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p3)

##### ç»“è®º

ç»è¿‡åˆæ­¥åˆ†æï¼Œå‘ç°çˆ¬å–å¤§ä¼—ç‚¹è¯„ç”¨æˆ·è¯„è®ºæœ‰ä¸‰ä¸ªéš¾ç‚¹ï¼š
1. æŸ¥çœ‹å®Œæ•´è¯„è®ºå’Œæ›´å¤šè¯„è®ºéœ€è¦ç™»é™†åæ‰å¯ä»¥
2. è¯„è®ºæ•°æ®åŒ…çš„é“¾æ¥æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ç ”ç©¶é¡µé¢jsä»£ç 
3. è¯„è®ºæ•°æ®ä¸å®Œæ•´ï¼Œéƒ¨åˆ†æ–‡å­—è¢«æ›¿æ¢



### 2. Seleniumè‡ªåŠ¨åŒ–ç™»é™†

åŸºäºåˆæ­¥åˆ†æé‡åˆ°çš„å›°éš¾ï¼Œå†³å®šé‡‡ç”¨Seleniumè°ƒç”¨æµè§ˆå™¨é‡‡å–æ‰‹åŠ¨ç™»é™†çš„æ–¹å¼æ¥è§£å†³å‰ä¸¤ä¸ªé—®é¢˜ï¼š

```python
import time
import random
from selenium import webdriver

url = 'http://www.dianping.com/shop/G41gaJfqGBICtiVY/review_all/p{}'
driver = webdriver.Firefox(executable_path=r'geckodriver.exe')
driver.get(url.format(1))

time.sleep(30)    # æš‚åœ30s,åœ¨è¿™ä¸ªæ—¶é—´å†…è¿›è¡Œç™»é™†æ“ä½œ

# è¿™é‡Œé€‰æ‹©åªçˆ¬å–ä¸‰é¡µæ•°æ®
for i in range(1, 3):
    driver.get(url.format(i))
    time.sleep(random.randint(5, 10))
    driver.find_element_by_class_name('fold').click() # å‘é€ç‚¹å‡»äº‹ä»¶å±•å¼€è¯„è®º
    time.sleep(2)
	# å°†æ¸²æŸ“åçš„ç½‘é¡µä¿å­˜ä¸ºæ–‡ä»¶ï¼Œå°±ä¸ç”¨å¤šæ¬¡è¿è¡Œçˆ¬è™«äº†
    with open('html/p%d.html'%i, 'w', encoding='utf-8') as f:
        f.write(driver.page_source)

driver.close()
```
### 3.  æ­ç§˜CSSåçˆ¬

å‰©ä¸‹æœ€åä¸€ä¸ªé—®é¢˜å°±æ˜¯è§£å†³è¯„è®ºä¸­éƒ¨åˆ†å†…å®¹è¢«æ›¿æ¢çš„é—®é¢˜ã€‚
##### åˆ†æCSSåŠ å¯†è¿‡ç¨‹

å®¡æŸ¥é¡µé¢å…ƒç´ ï¼Œå‘ç°è¢«æ›¿æ¢éƒ¨åˆ†çš„ä¸€äº› CSSä¿¡æ¯ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª**backgroung-image**
![æŸ¥çœ‹å…ƒç´ ](https://img-blog.csdnimg.cn/20200618233446634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
æ‰“å¼€è¿™ä¸ªé“¾æ¥å‘ç°æ˜¯ä¸€ä¸ªsvgæ–‡ä»¶ï¼Œé‡Œé¢æœ‰è®¸å¤šæ–‡å­—ï¼Œæœç´¢å‘ç°åœ¨é¡µé¢ä¸­æœ‰ç€è¢«æ›¿æ¢çš„æ–‡å­—ï¼Œå¹¶ä¸”åœ¨å®¡æŸ¥å…ƒç´ æ—¶å‘ç°é¡µé¢æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å€¼â€”â€”**xå’Œy**
![svgæ–‡ä»¶](https://img-blog.csdnimg.cn/20200618234735461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
å…ˆä¼šå„¿åœ¨å®¡æŸ¥åŸæ¥é¡µé¢çš„æ—¶å€™ä¹Ÿå‘ç°äº†**xå’Œyå€¼**ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ€€ç–‘è¿™ä¸¤ä¸ªéƒ¨åˆ†ä¹‹é—´æ˜¯å¦ä¼šæœ‰å…³è”ã€‚
![åŸé¡µé¢](https://img-blog.csdnimg.cn/202006182350197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)
é€šè¿‡åˆ†æç±»ä¼¼å…ƒç´ æ‰¾åˆ°è§„å¾‹ï¼š
**é¡µé¢xå€¼ / 14px(å­—ä½“å®½åº¦) = å­—ä½“åº“ä¸­çš„æ–‡å­—æ‰€åœ¨è¡Œçš„ä½ç½®(ä»0å¼€å§‹æ•°)**
**é¡µé¢yå€¼ + 23px = å­—ä½“åº“ä¸­çš„æ–‡å­—æ‰€åœ¨è¡Œçš„y**
##### åŠ å¯†è¿‡ç¨‹

```mermaid
graph LR
	A(è¯„è®º) --> |éšæœºæŠ½å–æ–‡å­—| B(å­—ä½“åº“)
	B --> |ç”Ÿæˆå›¾ç‰‡| A
```

##### ä»£ç 

CSSåŠ å¯†è¿‡ç¨‹æ—¢ç„¶å·²ç»äº†è§£äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è§£å¯†äº†ï¼š

```python
import re
import requests

# åŠ è½½htmlæ–‡ä»¶å†…å®¹
with open('html/p1.html', 'r', encoding='utf-8') as f:
    html = f.read()

# è·å–cssæ–‡ä»¶
css = re.findall('<link rel="stylesheet" type="text/css" href="(.*?)">', html, re.S)
css_url = 'http:{}'.format(css[1])
css_content = requests.get(css_url).text
with open('css/css.css', 'w', encoding='utf-8') as f:
    f.write(css_content)

# è·å–å­—åº“
font = re.findall('background-image: url\((.*?)\);', css_content, re.S)
font_url = 'http:{}'.format(font[1])
font_content = requests.get(font_url).text
with open('font/font.swg', 'w', encoding='utf-8') as f:
    f.write(font_content)


# è·å–ä¿¡æ¯
for i in range(1, 3):
    with open('html/p{}.html'.format(i), 'r', encoding='utf-8') as f:
        html = f.read()

    inf = re.findall('<div class="review-words(.*?)<div class="less-words">', html, re.S)
    for record in inf:
        inf_copy = record
        svgmti = re.findall('<svgmtsi class="(.*?)">', record)
        for class_name in svgmti:
            XY = re.findall('.%s{background:-(.*?)px -(.*?)px;}'%class_name, css_content, re.S)
            X = int(float(XY[0][0])/14)    # è¢«æ›¿æ¢çš„æ–‡å­—Xåæ ‡æ¢ç®—ä¸ºå­—ä½“åº“çš„X
            Y = int(float(XY[0][1]) + 23)  # è¢«æ›¿æ¢çš„æ–‡å­—Yåæ ‡æ¢ç®—ä¸ºå­—ä½“åº“çš„Y
            fo = re.findall('<text x="0" y="%s">(.*?)</text>'%Y, font_content)
            inf_copy = re.sub(f'<svgmtsi class="{class_name}"></svgmtsi>', fo[0][X], inf_copy, count=0)

        # åˆ é™¤å¹²æ‰°å­—ç¬¦
        inf_copy = re.sub('<img .*? alt="">', '', inf_copy, count=0)
        inf_copy = re.sub('</div>.*?<div class="review-words', '', inf_copy, count=0, flags=re.S)
        inf_copy = inf_copy.replace('Hide">', '')
        inf_copy = inf_copy.replace('">', '')
        inf_copy = inf_copy.replace('\n', '')
        inf_copy = inf_copy.replace(' ', '')
        inf_copy = inf_copy.strip()
        print(inf_copy)
```

##### ç»“è¯­

åœ¨ååçˆ¬è™«çš„è¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦ç»†è‡´ï¼Œæ¯ä¸€ä¸ªç»†èŠ‚éƒ½å¯èƒ½æˆä¸ºç ´è¯‘çš„å…³é”®ã€‚
**PSï¼šçˆ¬è™«è™½å¥½ï¼Œå¯ä¸è¦è´ªæ¯å“¦ï¼Œå°å¿ƒé¢å‘ç›‘ç‹±ç¼–ç¨‹å“¦ğŸ˜‚**
![æŸ¯å—](https://img-blog.csdnimg.cn/20200619001553644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNTgwMTkz,size_16,color_FFFFFF,t_70)

##### 4. å®Œæ•´ä»£ç 

å¦‚æœè§‰å¾—æœ‰å¸®åŠ©ï¼Œè¯·ä¸ºåšä¸»ç‚¹ä¸€ä¸ªå°å°çš„ <p>star âœ©</p>å§ï¼Œä½ çš„é¼“åŠ±æ˜¯åšä¸»æœ€å¤§çš„åŠ¨åŠ›ï¼
[ä¼ é€é—¨]([https://github.com/1314liuwei/python_spider/blob/master/No.2%20%E5%A4%A7%E4%BC%97%E7%82%B9%E8%AF%84%E8%AF%84%E8%AE%BA%E7%88%AC%E5%8F%96/main.py](https://github.com/1314liuwei/python_spider/blob/master/No.2 å¤§ä¼—ç‚¹è¯„è¯„è®ºçˆ¬å–/main.py))

[![Uxuoss.th.png](https://s1.ax1x.com/2020/07/24/Uxuoss.th.png)](https://imgchr.com/i/Uxuoss)